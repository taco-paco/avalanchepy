from avalanchepy.types.avax.utxo import Utxo
from avalanchepy.types.codecs import PVM_CODEC
from avalanchepy.types.utils import pack_codec_direct, unpack_codec_direct


def test_utxo_1():
    utxo_hex = "0x00004cc3cf2e380c03f0227193a6573d1940350a43f028123ca68c14f54e33a11dcf000000093d9bdac0ed1d761330cf680efdeb1a42159eb387d6d2950c96f7d28f61bbe2aa000000160000000063af7b800000000700000002540be40000000000000000000000000100000001e0cfe8cae22827d032805ded484e393ce51cbedb7f24bb9c"  # noqa: E501
    utxo_bytes = bytes.fromhex(utxo_hex[2:])

    (utxo, leftover) = unpack_codec_direct(Utxo, PVM_CODEC, utxo_bytes)
    utxo_bytes_actual = pack_codec_direct(PVM_CODEC, utxo)

    # has 4 extra bytes
    assert len(leftover) == 4
    assert utxo_bytes_actual == utxo_bytes[:-4]


def test_utxo_2():
    data = bytes(
        [
            # Codec ID:
            # 0x00, 0x00,
            # txID:
            0xF9,
            0x66,
            0x75,
            0x0F,
            0x43,
            0x88,
            0x67,
            0xC3,
            0xC9,
            0x82,
            0x8D,
            0xDC,
            0xDB,
            0xE6,
            0x60,
            0xE2,
            0x1C,
            0xCD,
            0xBB,
            0x36,
            0xA9,
            0x27,
            0x69,
            0x58,
            0xF0,
            0x11,
            0xBA,
            0x47,
            0x2F,
            0x75,
            0xD4,
            0xE7,
            # utxo index:
            0x00,
            0x00,
            0x00,
            0x00,
            # assetID:
            0x00,
            0x01,
            0x02,
            0x03,
            0x04,
            0x05,
            0x06,
            0x07,
            0x08,
            0x09,
            0x0A,
            0x0B,
            0x0C,
            0x0D,
            0x0E,
            0x0F,
            0x10,
            0x11,
            0x12,
            0x13,
            0x14,
            0x15,
            0x16,
            0x17,
            0x18,
            0x19,
            0x1A,
            0x1B,
            0x1C,
            0x1D,
            0x1E,
            0x1F,
            # output:
            0x00,
            0x00,
            0x00,
            0x07,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x30,
            0x39,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0x00,
            0xD4,
            0x31,
            0x00,
            0x00,
            0x00,
            0x01,
            0x00,
            0x00,
            0x00,
            0x02,
            0x00,
            0x01,
            0x02,
            0x03,
            0x04,
            0x05,
            0x06,
            0x07,
            0x08,
            0x09,
            0x0A,
            0x0B,
            0x0C,
            0x0D,
            0x0E,
            0x0F,
            0x10,
            0x11,
            0x12,
            0x13,
            0x14,
            0x15,
            0x16,
            0x17,
            0x18,
            0x19,
            0x1A,
            0x1B,
            0x1C,
            0x1D,
            0x1E,
            0x1F,
            0x20,
            0x21,
            0x22,
            0x23,
            0x24,
            0x25,
            0x26,
            0x27,
        ]
    )

    (utxo, leftover) = Utxo.deserialize(data, PVM_CODEC)
    assert len(leftover) == 0
    assert utxo.serialize(PVM_CODEC) == data
